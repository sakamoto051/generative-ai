# 要件定義書

## プロジェクト概要

### プロジェクト名
生産計画最適化・原価管理システム（ProCost Manager）

### プロジェクトの目的

#### 背景
製造業において、生産計画の最適化と正確な原価管理は収益性を大きく左右する重要な課題である。現状では以下の問題が存在している:

1. **生産計画の非効率性**: Excelベースの手作業による計画立案により、設備稼働率の最適化が困難
2. **原価計算の遅延**: 月次の原価計算に数週間を要し、タイムリーな経営判断ができない
3. **データの分散**: 生産、在庫、原価のデータが複数システムに分散し、統合的な分析が困難
4. **承認プロセスの煩雑さ**: 紙ベースの承認フローにより、意思決定が遅延
5. **トレーサビリティの欠如**: 製品の製造履歴や原価の内訳が追跡困難

#### 目的
1. **生産効率の最大化**: システムによる生産計画の立案支援により、設備稼働率を20%向上
2. **原価計算の迅速化**: リアルタイムな原価計算により、日次での損益把握を実現
3. **意思決定の高速化**: デジタル承認ワークフローにより、承認リードタイムを50%削減
4. **品質の向上**: 製造履歴の完全トレーサビリティにより、不良品発生時の原因特定を迅速化
5. **データ駆動経営**: 統合されたデータ分析により、戦略的な経営判断をサポート

#### 対象ユーザー
- **生産管理者**: 生産計画の立案・調整・承認を行う
- **製造現場リーダー**: 製造指示の実行・進捗報告・品質管理を行う
- **原価計算担当者**: 原価計算・差異分析・レポート作成を行う
- **購買担当者**: 材料発注・納期管理・仕入価格管理を行う
- **経営層**: KPI確認・承認・経営判断を行う
- **品質管理者**: 検査結果入力・不良分析・改善提案を行う

---

## 業務フロー

### 全体業務フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                          受注・需要予測                           │
└─────────────────┬───────────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────────────┐
│                    生産計画立案（自動最適化）                     │
│  ・需要予測データ読込 ・設備能力計算 ・材料所要量計算            │
└─────────────────┬───────────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────────────┐
│              生産計画承認フロー（多段階承認）                     │
│  担当者 → 生産管理者 → 工場長 → 承認完了                        │
└─────────────────┬───────────────────────────────────────────────┘
                  ↓
         ┌────────┴────────┐
         ↓                 ↓
┌─────────────────┐  ┌──────────────────┐
│   材料手配       │  │  製造指示発行     │
│ ・所要量計算     │  │ ・作業指示書出力  │
│ ・発注書作成     │  │ ・工程別割当     │
└────────┬────────┘  └────────┬─────────┘
         ↓                 ↓
         └────────┬────────┘
                  ↓
┌─────────────────────────────────────────────────────────────────┐
│                        製造実行・進捗管理                         │
│  工程1 → 工程2 → 工程3 → ... → 最終工程                         │
│  (各工程で実績入力・品質検査・ステータス更新)                     │
└─────────────────┬───────────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────────────┐
│                    最終検査・完成品登録                           │
└─────────────────┬───────────────────────────────────────────────┘
                  ↓
         ┌────────┴────────┐
         ↓                 ↓
┌─────────────────┐  ┌──────────────────┐
│  出荷処理        │  │  原価計算        │
└─────────────────┘  │ ・材料費集計     │
                      │ ・労務費配賦     │
                      │ ・経費配賦       │
                      │ ・差異分析       │
                      └────────┬─────────┘
                               ↓
                      ┌──────────────────┐
                      │ 原価差異承認フロー│
                      │ (基準超過時)     │
                      └────────┬─────────┘
                               ↓
                      ┌──────────────────┐
                      │  損益分析・報告   │
                      └──────────────────┘
```

### 業務フロー詳細

#### 1. 生産計画立案フロー

**1.1 需要データ取込**
1. 生産管理者が計画画面にアクセス
2. 期間を指定（週次/月次）
3. 受注データを選択
   - 確定受注データの自動取込
   - 見込み需要の手動入力またはExcelインポート
4. 需要予測データの確認
5. 在庫状況の確認（現在庫、安全在庫、発注残）
6. データ検証（不整合チェック）

**1.2 生産計画案生成**
1. 「計画案作成」ボタンをクリック
2. システムが以下を自動計算:
   - 製品別所要量計算（需要 - 在庫 + 安全在庫）
   - BOM展開による部品所要量計算
   - 設備能力チェック（各工程の稼働可能時間）
   - 制約条件の考慮（段取り時間、最小ロット、優先度）
   - 生産順序の提案（優先度、納期、設備稼働率を考慮）
3. 計算完了（進捗バー表示、通常1-3分）
4. 生産計画案の表示
   - ガントチャート形式
   - 設備別稼働率
   - 材料所要量一覧
   - 完成予定日一覧

**1.3 計画の手動調整**
1. 計画案を確認
2. 必要に応じて手動調整
   - 製造順序の入れ替え（ドラッグ&ドロップ）
   - 製造数量の変更
   - 納期の調整
   - 設備の変更
3. 調整後、再計算実行（影響範囲を自動計算）
4. 実行可能性チェック
   - 設備能力超過の警告
   - 材料不足の警告
   - 納期遅延リスクの表示
5. コメント入力（調整理由）

**1.4 計画のシミュレーション**
1. 複数パターンの計画を作成（最大5パターン）
2. 各パターンの比較
   - 設備稼働率
   - 材料費
   - リードタイム
   - 納期遵守率
3. 最適パターンを選択
4. 計画の確定前保存（下書き状態）

**1.5 承認申請**
1. 計画内容の最終確認
2. 承認依頼書の作成
   - 計画サマリー自動生成
   - 前回計画との差異表示
   - 想定原価の表示
3. 承認ルート選択（通常/緊急）
4. 申請理由入力
5. 承認申請実行
6. 承認者への通知送信（メール・システム通知）

#### 2. 承認フロー

**2.1 第一承認（生産管理者）**
1. 承認者に通知が届く
2. 承認画面にアクセス
3. 計画内容を確認
   - 需要との整合性
   - 設備稼働率
   - 材料手配の実現可能性
   - 原価見積もり
4. 詳細データのダウンロード（Excel）
5. 判断:
   - **承認**: 次の承認者へエスカレーション
   - **差戻し**: 差戻し理由を入力、申請者へ通知
   - **却下**: 却下理由を入力、計画を中止
   - **保留**: 追加情報を要求
6. コメント入力（必須）
7. 承認操作実行

**2.2 第二承認（工場長）**
1. 第一承認通過後、工場長に通知
2. 承認画面にアクセス
3. 全体最適の観点で確認
   - 他部門との調整事項
   - 品質リスク
   - 納期リスク
   - コスト妥当性
4. 承認履歴の確認（過去のコメント）
5. 判断（承認/差戻し/却下）
6. 最終承認の場合、計画確定

**2.3 緊急承認ルート**
1. 緊急フラグ付き申請の場合
2. 承認者全員に同時通知
3. 先着で承認した者から順次処理
4. 一定時間内（2時間）に承認なければエスカレーション
5. 工場長が最終判断

**2.4 承認後処理**
1. 計画ステータスを「承認済み」に変更
2. 関連部門へ通知（製造、購買、品質）
3. 製造指示書の自動生成準備
4. 材料発注データの生成
5. 承認履歴の記録（承認者、日時、コメント）

#### 3. 製造指示・実行フロー

**3.1 製造指示書発行**
1. 承認済み計画から自動生成
2. 製品別・工程別に指示書を分割
3. 指示書内容:
   - 製造番号（自動採番）
   - 製品名・型番
   - 製造数量
   - 工程別作業内容
   - 使用材料リスト（ロット番号管理）
   - 品質基準
   - 完成予定日時
   - 作業者割当
4. QRコード生成（製造番号）
5. PDF出力・印刷
6. 現場端末へ配信

**3.2 材料払出**
1. 製造指示書をスキャン（QRコード）
2. 必要材料リストを表示
3. 材料をピッキング
4. バーコードスキャンで実績登録
   - 材料コード
   - ロット番号
   - 払出数量
5. 不足材料がある場合、警告表示
6. 払出完了、在庫引落し
7. 製造指示のステータスを「材料準備完了」に更新

**3.3 製造作業開始**
1. 作業者が現場端末にログイン
2. 担当作業の一覧表示
3. 作業を選択
4. 「作業開始」ボタンをタップ
5. 作業開始時刻を記録
6. ステータスを「製造中」に更新
7. 必要に応じて作業手順書を表示
8. 使用設備の稼働記録開始

**3.4 工程進捗記録**
1. 各工程完了時に実績入力
   - 完了数量
   - 不良数量（不良内容も記録）
   - 作業時間
   - 使用設備
   - 作業者
2. 工程検査の実施（必要に応じて）
   - 検査項目チェックリスト
   - 測定値入力
   - 合格/不合格判定
3. 不良品発生時の処理
   - 不良内容詳細入力
   - 写真撮影（アップロード）
   - 不良原因の仮説入力
   - 品質管理者へ自動通知
4. 工程完了、次工程へ引継ぎ
5. ステータス更新

**3.5 製造完了・最終検査**
1. 最終工程完了
2. 最終検査待ちステータスへ移行
3. 品質管理者が最終検査実施
   - 外観検査
   - 寸法検査
   - 機能検査
   - 検査成績書作成
4. 合格判定
   - 完成品在庫へ登録
   - ロット番号発行
   - 製造履歴の確定
5. 不合格判定
   - 手直し指示または廃棄判定
   - 不良原因分析フロー開始

#### 4. 原価計算フロー

**4.1 製造原価データ収集**
1. 原価計算担当者が対象期間を指定（日次/週次/月次）
2. システムが自動でデータ収集:
   - **材料費**: 材料払出実績から集計
     - 材料コード別使用量
     - ロット別単価
     - 払出日時
   - **労務費**: 作業実績から集計
     - 作業者別作業時間
     - 時間単価（職種・等級別）
     - 残業・深夜手当
   - **経費**:
     - 設備稼働時間 × 時間チャージ
     - 電力使用量
     - 消耗品費
     - 間接部門費
3. データ整合性チェック
   - 製造指示と実績の突合
   - 材料払出と使用実績の突合
   - 異常値の検出

**4.2 原価計算実行**
1. 「原価計算実行」ボタンをクリック
2. 計算方法選択
   - 実際原価計算
   - 標準原価計算
   - 直接原価計算
3. 配賦基準の確認・調整
   - 労務費配賦: 直接作業時間基準
   - 製造経費配賦: 機械稼働時間基準
   - 間接部門費配賦: 直接費比例配賦
4. 計算実行（進捗表示）
   - 直接材料費計算
   - 直接労務費計算
   - 製造間接費配賦
   - 仕掛品原価計算
   - 完成品原価計算
5. 計算完了通知

**4.3 標準原価との差異分析**
1. 計算結果画面を表示
2. 製品別原価一覧
   - 実際原価
   - 標準原価
   - 差異金額
   - 差異率
3. 差異の内訳分析
   - **材料費差異**:
     - 価格差異（実際単価 - 標準単価）× 実際数量
     - 数量差異（実際数量 - 標準数量）× 標準単価
   - **労務費差異**:
     - 賃率差異（実際賃率 - 標準賃率）× 実際時間
     - 作業時間差異（実際時間 - 標準時間）× 標準賃率
   - **経費差異**:
     - 予算差異（実際経費 - 予算経費）
     - 操業度差異（基準操業度 - 実際操業度）× 固定費率
     - 能率差異（実際時間 - 標準時間）× 変動費率
4. 差異の視覚化
   - ウォーターフォールチャート
   - 差異要因の円グラフ
   - トレンドグラフ（時系列推移）

**4.4 差異原因分析**
1. 基準値超過差異の自動抽出（閾値: ±5%以上）
2. 各差異項目の詳細ドリルダウン
   - 製品別
   - 工程別
   - 材料別
   - 作業者別
3. 過去データとの比較
4. 原因仮説の入力（担当者コメント）
5. 改善アクションの記録
6. 製造部門へのフィードバック依頼

**4.5 原価差異承認フロー**
1. 重要差異（±10%以上または100万円以上）の場合、承認フロー開始
2. 差異報告書の自動生成
   - 差異サマリー
   - 詳細内訳
   - 原因分析結果
   - 改善提案
3. 承認ルート: 原価担当者 → 経理部長 → 工場長 → CFO
4. 各承認者が差異内容を確認
5. 承認/差戻し/追加調査依頼
6. 最終承認後、原価確定
7. 会計システムへデータ連携

#### 5. データインポート・エクスポートフロー

**5.1 生産計画一括登録（Excelインポート）**
1. 「データインポート」メニューを選択
2. インポート種別を選択: 「生産計画」
3. テンプレートファイルをダウンロード
   - 製品コード、製品名、数量、納期、優先度などの列を含む
4. Excelでデータ作成・編集
5. ファイルをアップロード（drag & drop または選択）
6. ファイル形式チェック
   - 拡張子: .xlsx, .xls
   - ファイルサイズ: 最大10MB
   - シート構成の検証
7. データ検証（バックグラウンド処理）
   - 必須項目チェック
   - データ型チェック（数値、日付など）
   - マスタ存在チェック（製品コード、設備コードなど）
   - 業務ルールチェック（数量上限、納期妥当性など）
   - 重複チェック
8. 検証結果の表示
   - エラー件数、警告件数
   - エラー詳細リスト（行番号、項目、エラー内容）
   - エラー行のハイライト表示
9. エラーがある場合:
   - エラーリストをExcelでダウンロード
   - 修正して再アップロード
10. エラーなしの場合:
    - プレビュー画面で登録内容を確認
    - 登録件数表示
11. 「一括登録」ボタンをクリック
12. トランザクション処理（全件成功または全件ロールバック）
13. 登録完了、結果サマリー表示

**5.2 BOM（部品表）インポート**
1. 「BOMインポート」を選択
2. テンプレートダウンロード
   - 親品目コード、子品目コード、使用数量、歩留まり率などの列
3. Excelでデータ作成
   - 階層構造の表現（親子関係）
   - 複数レベルのBOM対応
4. ファイルアップロード
5. データ検証
   - 循環参照チェック（A→B→A のような循環）
   - 階層深さチェック（最大10階層）
   - 品目マスタ存在チェック
   - 数量の妥当性チェック
6. BOM展開シミュレーション
   - 最下層部品までの展開計算
   - 所要量計算のサンプル実行
7. 検証結果確認
8. 登録実行
9. 既存BOMの更新または新規登録を選択
10. 更新履歴の記録

**5.3 実績データエクスポート**
1. 「データエクスポート」メニューを選択
2. エクスポート種別を選択
   - 生産実績
   - 原価計算結果
   - 不良分析データ
   - 設備稼働実績
3. 抽出条件の指定
   - 期間（開始日〜終了日）
   - 製品カテゴリ
   - 工場・ライン
   - その他フィルタ条件
4. 出力項目の選択
   - プリセット選択（標準/詳細/カスタム）
   - カスタムの場合、項目をチェックボックスで選択
5. 出力形式の選択
   - Excel（.xlsx）
   - CSV（文字コード: UTF-8/Shift-JIS選択可）
   - PDF（レポート形式）
6. 「エクスポート実行」ボタンをクリック
7. バックグラウンドでファイル生成（大量データの場合）
   - 進捗状況表示
   - 生成完了時にメール通知
8. ファイルダウンロード
9. ダウンロード履歴の記録（7日間保持）

**5.4 原価計算レポート出力**
1. 原価計算結果画面から「レポート出力」を選択
2. レポート種類を選択
   - 製品別原価計算書
   - 原価差異分析表
   - 損益分岐点分析
   - 部門別原価集計表
3. 出力期間指定
4. 比較対象期間指定（前月/前年同月/任意期間）
5. グラフ種類選択
   - 棒グラフ/折れ線グラフ/円グラフ/ウォーターフォール
6. Excel出力の場合:
   - 複数シート構成
   - ピボットテーブル自動生成
   - グラフの埋め込み
   - 条件付き書式設定（差異の色分け）
7. PDF出力の場合:
   - 表紙自動生成
   - 目次自動生成
   - ページ番号・ヘッダー・フッター
   - グラフ・表の最適配置
8. ファイル生成・ダウンロード

#### 6. エラーリカバリフロー

**6.1 生産計画の取り消し・修正**
1. 生産計画一覧から対象計画を選択
2. ステータスに応じた操作可能範囲を表示
   - **計画中**: 自由に編集・削除可能
   - **承認待ち**: 申請取り下げ可能
   - **承認済み**: 製造開始前であれば修正申請可能
   - **製造中**: 一部修正可能（数量増のみ、減は不可）
   - **完了**: 修正不可、訂正計画を新規作成
3. 修正内容の入力
4. 影響範囲の自動計算
   - 関連する製造指示
   - 発注済み材料
   - 後続計画への影響
5. 影響確認画面の表示
6. 修正理由の入力（必須）
7. 再承認フローの開始（必要な場合）
8. 修正履歴の記録

**6.2 製造指示の中止・巻き戻し**
1. 製造指示一覧から対象を選択
2. 「中止」または「巻き戻し」を選択
3. 現在のステータス確認
4. **中止の場合**:
   - 中止理由を選択（材料不良/設備故障/計画変更/その他）
   - 詳細理由入力
   - 処理済み工程の確認
   - 使用済み材料の処理方法選択（返却/廃棄）
   - 作業途中品の処理方法選択
   - 承認者への通知
   - 中止実行
5. **巻き戻しの場合**:
   - 巻き戻し先工程を選択
   - 巻き戻し理由入力
   - 該当工程以降の実績データを一時退避
   - 材料払出の調整計算
   - 作業時間の補正
   - 巻き戻し実行
6. 関連データの整合性チェック
7. 在庫数量の調整
8. 原価計算への影響を記録

**6.3 原価計算のやり直し**
1. 原価計算結果一覧から対象期間を選択
2. 「再計算」ボタンをクリック
3. 再計算理由の選択
   - データ修正（実績修正/マスタ修正）
   - 配賦基準変更
   - 計算ミス発見
   - その他
4. 変更内容の入力
5. 影響範囲の確認
   - 再計算対象の製造番号リスト
   - 前回計算結果との差異予測
6. 現在の原価データをバックアップ
   - 「原価計算履歴」として保存
   - 前回計算との比較可能な状態を保持
7. 再計算実行
8. 新旧比較レポートの自動生成
   - 差異サマリー
   - 差異詳細
   - 変更理由
9. 再承認が必要な場合、承認フロー開始
10. 確定後、会計システムへ再連携

**6.4 一括データ修正**
1. 「データメンテナンス」メニューを選択
2. 修正対象データ種別を選択
   - 製造実績
   - 材料払出実績
   - 作業時間実績
   - 品質検査結果
3. 修正対象の検索
   - 期間指定
   - 製造番号指定
   - 製品コード指定
   - その他条件
4. 修正対象データ一覧を表示（最大1000件）
5. 修正方法の選択
   - **画面上で個別修正**: 1件ずつ編集
   - **一括修正**: 特定項目を一括で変更
   - **Excelダウンロード修正**: Excelで編集後アップロード
6. Excelダウンロード修正の場合:
   - 現在値をExcelでダウンロード
   - Excel上で修正
   - アップロード
   - 差分検証（変更前後の比較）
   - 変更内容の確認画面表示
7. 修正理由の入力（必須）
8. 承認者の選択（重要な修正の場合）
9. 修正実行
10. 修正履歴の記録
    - 修正日時
    - 修正者
    - 修正内容（変更前/変更後）
    - 修正理由
11. 関連データへの影響を自動反映
    - 原価計算の再計算フラグ設定
    - 生産計画の整合性チェック

**6.5 過去時点へのロールバック**
1. 「システム管理」→「データロールバック」を選択
2. ロールバック対象モジュールを選択
   - 生産計画
   - 製造実績
   - 原価計算
   - 全体
3. ロールバック日時を指定
   - カレンダーから日付選択
   - 時刻選択（1時間単位）
4. ロールバックシミュレーション
   - 削除されるデータの件数表示
   - 復元されるデータの件数表示
   - 影響範囲のサマリー
5. 警告メッセージの表示
   - 「この操作は取り消せません」
   - 影響を受けるユーザーへの通知確認
6. 二重確認（パスワード再入力）
7. 管理者承認（重要操作のため）
8. ロールバック実行
   - 現在データのフルバックアップ作成
   - 指定時点のデータを復元
   - トランザクションログの調整
9. 完了通知
10. ロールバック履歴の記録

#### 7. 不良品対応・品質改善フロー

**7.1 不良品発見・登録**
1. 製造工程または検査工程で不良品を発見
2. 現場端末で「不良報告」を選択
3. 製造番号をスキャン（QRコード）
4. 不良情報の入力
   - 不良数量
   - 不良内容（ドロップダウン選択 + 詳細入力）
   - 発見工程
   - 発見者
   - 発見日時（自動入力）
5. 不良品の写真撮影・アップロード（最大5枚）
6. 一次対応の選択
   - 手直し可能
   - 廃棄
   - 判断保留（品質管理者確認待ち）
7. 不良報告を登録
8. 品質管理者へ自動通知

**7.2 不良原因分析**
1. 品質管理者が不良報告を確認
2. 不良品の詳細情報を確認
   - 製造履歴（使用材料、作業者、設備、工程条件）
   - 類似不良の過去事例検索
   - トレンド分析（同製品の不良率推移）
3. 現物確認・詳細検査の実施
4. 原因分析手法の選択
   - なぜなぜ分析（5Why）
   - 特性要因図（フィッシュボーン）
   - FTA（Fault Tree Analysis）
5. 分析結果の入力
   - 真因の特定
   - 要因カテゴリ（4M: Man/Machine/Material/Method）
   - 再発防止策の提案
6. 対策の緊急度判定
   - 即時対応必要（他ロットへの影響大）
   - 通常対応（改善計画に組み込み）
7. 関係部門への展開

**7.3 是正処置・承認**
1. 品質管理者が是正処置案を作成
2. 処置内容
   - 即時対策（応急処置）
   - 恒久対策（再発防止）
   - 水平展開（類似製品・工程への適用）
3. 実施スケジュール
4. 担当部署・担当者の指定
5. 承認ルート: 品質管理者 → 製造部長 → 工場長
6. 各承認者が妥当性を確認
7. 承認完了後、対策実施へ

**7.4 対策実施・効果確認**
1. 担当部署が対策を実施
2. 実施内容の記録
   - 実施日
   - 実施内容
   - 実施者
   - 実施前後の比較データ
3. 効果測定期間の設定（通常1ヶ月）
4. 期間中の不良率モニタリング
5. 効果確認
   - 不良率の改善確認
   - 目標達成可否
6. 結果報告書の作成
7. 標準化
   - 作業手順書の更新
   - チェックリストの改訂
   - 教育訓練の実施
8. ナレッジベースへの登録

---

## 機能要件

### 1. 認証機能

#### 1.1 ユーザー認証
- **ログイン方式**
  - 社員番号とパスワードによる認証
  - LDAP/Active Directory連携（オプション）
  - シングルサインオン（SSO）対応（オプション）
  - 二要素認証（2FA）: 管理者・経営層は必須

- **パスワードポリシー**
  - 最小長: 10文字
  - 複雑性: 英大文字、英小文字、数字、記号を全て含む
  - 有効期限: 90日
  - 過去10回のパスワード再利用不可
  - 初回ログイン時の強制変更

- **アカウントロック**
  - ログイン失敗5回で30分間ロック
  - 管理者による手動ロック・解除
  - ロック通知（本人・管理者）

- **セッション管理**
  - セッションタイムアウト: 無操作30分
  - 同時ログインセッション数: 1（重複ログイン時は警告）
  - セッションハイジャック対策（トークン再生成）

#### 1.2 権限管理
- **ロールベースアクセス制御（RBAC）**
  - システム管理者
  - 経営層（閲覧のみ、承認権限あり）
  - 生産管理者（計画立案、承認、全データ閲覧）
  - 製造現場リーダー（実績入力、進捗確認）
  - 原価計算担当者（原価計算、分析、レポート出力）
  - 購買担当者（材料発注、仕入価格管理）
  - 品質管理者（検査入力、不良分析）
  - 一般作業者（実績入力のみ）

- **機能別権限**
  - 生産計画: 作成/編集/削除/承認/閲覧
  - 製造指示: 発行/中止/閲覧
  - 実績入力: 登録/修正/削除
  - 原価計算: 実行/修正/承認/閲覧
  - マスタ管理: 作成/編集/削除
  - システム設定: 変更/閲覧
  - データエクスポート: 実行/閲覧

- **データアクセス制御**
  - 工場別アクセス制限
  - 製品カテゴリ別アクセス制限
  - 期間制限（過去データの閲覧制限）

#### 1.3 監査ログ
- **記録対象操作**
  - ログイン/ログアウト
  - データ登録/更新/削除
  - 承認操作
  - マスタ変更
  - システム設定変更
  - データエクスポート
  - エラーリカバリ操作

- **ログ項目**
  - タイムスタンプ
  - ユーザーID・氏名
  - IPアドレス
  - 操作内容
  - 対象データ（テーブル・レコードID）
  - 変更前/変更後の値
  - 操作結果（成功/失敗）

### 2. トップページ（ダッシュボード）

#### 2.1 経営層向けダッシュボード
- **KPIサマリー（当月）**
  - 生産高（金額）
  - 設備稼働率
  - 納期遵守率
  - 不良率
  - 原価差異率
  - 各指標の前月比・前年同月比・目標比

- **グラフ表示**
  - 生産高推移（月次/週次、過去12ヶ月）
  - 製品カテゴリ別売上構成比（円グラフ）
  - 原価構成比（材料費/労務費/経費）
  - 不良率トレンド（折れ線グラフ）

- **アラート表示**
  - 納期遅延リスク（赤字案件）
  - 原価超過案件
  - 設備故障・メンテナンス期限
  - 在庫不足警告

- **承認待ちタスク**
  - 生産計画承認待ち件数
  - 原価差異承認待ち件数
  - 是正処置承認待ち件数

#### 2.2 生産管理者向けダッシュボード
- **生産計画ステータス**
  - 計画中/承認待ち/承認済み/実行中の件数
  - 今週の生産予定（製品別）
  - 来週の生産予定（概要）

- **設備稼働状況（リアルタイム）**
  - 設備別稼働状態（稼働中/停止中/メンテナンス中）
  - 設備別稼働率（本日/今週/今月）
  - ボトルネック工程の特定

- **進捗管理**
  - 製造指示別進捗率（ガントチャート）
  - 遅延案件リスト
  - 本日完了予定と実績

- **在庫状況**
  - 材料在庫過不足
  - 仕掛品在庫金額
  - 完成品在庫数量

#### 2.3 現場リーダー向けダッシュボード
- **本日の作業指示**
  - 担当ラインの製造指示リスト
  - 優先順位順の表示
  - 完了/未完了の区別

- **作業進捗**
  - 工程別進捗状況
  - 完了数量/目標数量
  - 遅延状況

- **品質情報**
  - 本日の不良発生件数
  - 不良率（当日/今週）
  - 要注意ポイント

- **材料・設備状況**
  - 本日使用予定材料の在庫確認
  - 設備メンテナンス予定
  - 設備異常アラート

#### 2.4 原価計算担当者向けダッシュボード
- **原価計算ステータス**
  - 未計算の製造番号件数
  - 計算中の件数
  - 承認待ち件数

- **原価差異サマリー**
  - 当月累計差異金額
  - 差異率トップ5製品
  - 差異トレンド（過去6ヶ月）

- **原価分析**
  - 製品別原価推移
  - 工程別原価構成
  - 材料別使用金額ランキング

- **タスクリスト**
  - 本日実施予定の原価計算
  - 差異分析が必要な案件
  - レポート提出期限

### 3. 生産計画管理機能

#### 3.1 需要データ管理
- **受注データ取込**
  - 販売システムからの自動連携（API）
  - 受注番号、製品コード、数量、納期の取得
  - 差分同期（新規受注のみ取込）
  - 取込履歴の記録

- **需要予測入力**
  - 製品別需要予測の手動入力
  - Excelインポート（テンプレート提供）
  - 過去実績からの自動予測（移動平均、指数平滑法）
  - 季節変動の考慮

- **需要調整**
  - 確定需要と予測需要の統合
  - 重複排除
  - 優先度設定（確定受注 > 見込み生産）

#### 3.2 生産計画立案
- **基礎情報設定**
  - 計画対象期間（週次/月次）
  - 計画単位（日/週）
  - 対象工場・ライン
  - 稼働カレンダー（休日設定）

- **制約条件設定**
  - 設備能力（ライン別/設備別の生産能力）
  - 段取り時間（品種切替時の段取り時間マトリクス）
  - 最小ロットサイズ
  - 在庫上限・下限
  - 材料リードタイム

- **計画案作成**
  - 優先度設定
    - 納期優先
    - 設備稼働率優先
    - 段取り回数最小化優先
    - 在庫金額最小化優先
    - カスタム優先度（重み付け設定）
  - 制約条件の考慮
  - ヒューリスティックな計画案の生成
  - 計算時間: 最大5分（タイムアウト設定可）

- **計画結果表示**
  - ガントチャート（製品別/設備別）
  - タイムライン表示（ズーム・スクロール可）
  - 色分け（製品カテゴリ、優先度）
  - ドラッグ&ドロップでの調整
  - 自動再計算（調整後の影響確認）

- **計画評価指標**
  - 設備稼働率（設備別/全体）
  - 納期遵守率
  - 段取り回数・時間
  - 総リードタイム
  - 在庫回転率

#### 3.3 材料所要量計算（MRP）
- **BOM展開**
  - 製品BOMの多階層展開
  - 親子関係の可視化（ツリー表示）
  - 使用数量の自動計算（歩留まり考慮）
  - サブアセンブリの中間在庫考慮

- **正味所要量計算**
  - 総所要量 = 生産予定数量 × BOM数量
  - 正味所要量 = 総所要量 - 現在庫 - 発注残 + 安全在庫
  - 期間別所要量（週別/日別）

- **発注提案**
  - 発注推奨数量
  - 発注推奨時期（リードタイム考慮）
  - 経済的発注量（EOQ）の考慮
  - 仕入先別集約

- **所要量表の出力**
  - 材料別所要量一覧
  - 期間別所要量推移
  - 不足材料の警告
  - Excelエクスポート

#### 3.4 計画シミュレーション
- **複数シナリオ作成**
  - 最大5パターンの計画を並行作成
  - パターン名・説明の設定
  - ベース計画のコピー機能

- **シナリオ比較**
  - 並列表示（2パターンまで）
  - 差分のハイライト
  - 評価指標の比較表
  - グラフでの可視化

- **What-If分析**
  - パラメータ変更時のシミュレーション
    - 需要数量の変更
    - 納期の変更
    - 設備能力の変更
    - 段取り時間の変更
  - 即座に結果を再計算
  - 影響範囲の可視化

#### 3.5 計画の確定・公開
- **計画の保存**
  - 下書き保存（編集継続可能）
  - バージョン管理（履歴保持）
  - 計画名・説明の設定

- **承認申請**
  - 承認ルートの選択（通常/緊急）
  - 申請コメント入力
  - 添付資料のアップロード（オプション）
  - 申請実行

- **計画公開**
  - 承認完了後、自動公開
  - 関係部門への通知
  - 製造指示生成の準備
  - 購買部門への所要量連携

### 4. 製造実行管理機能

#### 4.1 製造指示管理
- **製造指示書生成**
  - 承認済み生産計画からの自動生成
  - 製造番号の自動採番（書式設定可能）
  - 工程別指示書の分割
  - QRコード生成（製造番号エンコード）
  - 帳票レイアウトのカスタマイズ

- **指示書出力**
  - PDF生成
  - 一括印刷
  - 個別印刷
  - 現場端末への配信

- **指示書内容**
  - ヘッダー情報（製造番号、製品名、数量、納期）
  - 工程別作業内容
  - 使用材料リスト（材料コード、名称、必要数量）
  - 品質基準（検査項目、規格値）
  - 注意事項
  - 作業者割当

#### 4.2 材料管理
- **材料払出**
  - 製造指示書のQRコードスキャン
  - 必要材料リスト表示
  - バーコード/QRコードスキャンでピッキング
  - 数量入力（実払出数量）
  - ロット番号の記録
  - 在庫引落し（リアルタイム）

- **材料追加払出**
  - 不良等による追加払出
  - 理由コードの選択
  - 承認フロー（基準数量超過時）

- **材料返却**
  - 余剰材料の返却
  - 在庫戻し入れ
  - 返却理由の記録

- **ロット管理**
  - ロット番号のトレーサビリティ
  - 先入先出（FIFO）の徹底
  - ロット別在庫照会
  - ロット別使用履歴

#### 4.3 作業実績管理
- **作業開始**
  - 作業者ログイン（社員番号または顔認証）
  - 担当作業の選択
  - 作業開始ボタンタップ
  - 開始時刻の自動記録

- **進捗入力**
  - 完了数量の入力
  - 不良数量の入力（不良内容も選択）
  - 中断理由の記録（設備故障、材料待ちなど）
  - リアルタイムで進捗率を計算

- **工程完了**
  - 完了ボタンタップ
  - 完了時刻の自動記録
  - 作業時間の自動計算
  - 次工程への引継ぎ

- **作業日報**
  - 作業者別作業時間集計
  - 製品別作業時間集計
  - 残業時間の記録
  - 日報の承認

#### 4.4 品質管理
- **工程内検査**
  - 検査項目チェックリスト
  - 測定値入力（寸法、重量など）
  - 合格/不合格判定（自動判定または手動判定）
  - 不合格時の処置選択（手直し/廃棄）

- **最終検査**
  - 検査項目別チェック
  - 外観検査（写真撮影）
  - 機能検査（検査記録の入力）
  - 検査成績書の自動生成

- **不良品管理**
  - 不良内容の詳細記録（分類コード + 自由記述）
  - 不良品写真のアップロード
  - 不良原因の仮説入力
  - 不良品の隔離指示
  - 品質管理者への通知

- **検査記録**
  - 検査データの蓄積
  - ヒストグラム表示
  - 管理図（Xbar-R図、P図など）
  - 工程能力指数（Cp、Cpk）の計算

#### 4.5 設備管理
- **設備稼働記録**
  - 稼働開始/終了の自動記録（センサー連携）
  - 手動記録（センサーなし設備）
  - 稼働時間の集計
  - 停止時間の記録（停止理由も）

- **設備故障管理**
  - 故障発生時の記録
  - 故障内容の詳細入力
  - 修理依頼の発行
  - 修理完了の記録
  - 故障履歴の蓄積

- **予防保全**
  - メンテナンススケジュール管理
  - メンテナンス実施記録
  - 次回メンテナンス期日の自動計算
  - 期日前アラート

### 5. 原価計算機能

#### 5.1 原価データ収集
- **材料費データ**
  - 材料払出実績から自動収集
  - 材料コード別使用数量
  - ロット別単価取得（移動平均法または先入先出法）
  - 払出日時の記録

- **労務費データ**
  - 作業実績から自動収集
  - 作業者別作業時間
  - 職種・等級別時間単価
  - 直接作業時間と間接作業時間の区分
  - 残業・深夜手当の計算

- **経費データ**
  - 設備稼働時間 × 時間チャージ
  - 電力使用量（スマートメーター連携）
  - 消耗品費の配賦
  - 間接部門費の配賦

- **データ整合性チェック**
  - 製造指示と実績の突合
  - 材料払出と使用実績の突合
  - 異常値の検出（閾値超過のアラート）
  - エラーレポートの出力

#### 5.2 原価計算実行
- **計算方法選択**
  - **実際原価計算**: 実際発生額を集計
  - **標準原価計算**: 標準原価との差異分析
  - **直接原価計算**: 固定費と変動費を区分

- **直接費計算**
  - 直接材料費 = Σ(材料使用数量 × 単価)
  - 直接労務費 = Σ(直接作業時間 × 賃率)
  - 直接経費 = 外注費など

- **間接費配賦**
  - **製造間接費配賦**
    - 配賦基準: 直接作業時間、機械稼働時間、直接費比例
    - 部門別配賦率の計算
    - 配賦額 = 配賦基準 × 配賦率
  - **一般管理費配賦**（オプション）
    - 配賦基準: 製造原価比例
    - 配賦額の計算

- **仕掛品原価計算**
  - 月初仕掛品原価 + 当月投入原価 - 月末仕掛品原価 = 完成品原価
  - 工程別仕掛品の評価
  - 進捗率の考慮

- **完成品原価計算**
  - 製品別完成品原価
  - 単位原価 = 完成品原価 / 完成数量
  - ロット別原価

#### 5.3 標準原価差異分析
- **差異の計算**
  - 総差異 = 実際原価 - 標準原価
  - 差異率 = 総差異 / 標準原価 × 100

- **材料費差異分析**
  - **価格差異** = (実際単価 - 標準単価) × 実際数量
    - 仕入価格の変動が原因
    - 購買部門の責任
  - **数量差異** = (実際数量 - 標準数量) × 標準単価
    - 歩留まり、不良率の変動が原因
    - 製造部門の責任

- **労務費差異分析**
  - **賃率差異** = (実際賃率 - 標準賃率) × 実際時間
    - 残業、人員配置の変動が原因
  - **作業時間差異** = (実際時間 - 標準時間) × 標準賃率
    - 作業効率の変動が原因
    - 製造部門の責任

- **製造間接費差異分析**
  - **予算差異** = 実際発生額 - (変動費率 × 実際操業度 + 固定費予算)
    - 予算管理の問題
  - **操業度差異** = (基準操業度 - 実際操業度) × 固定費率
    - 稼働率低下による固定費の未回収
  - **能率差異** = (実際時間 - 標準時間) × 変動費率
    - 作業効率の問題

- **差異の可視化**
  - ウォーターフォールチャート（標準原価から実際原価への変動）
  - 差異要因の円グラフ
  - 製品別差異のランキング
  - 時系列トレンドグラフ

#### 5.4 原価シミュレーション
- **What-Ifシミュレーション**
  - 材料単価変動時の原価影響
  - 歩留まり改善時の原価影響
  - 作業時間短縮時の原価影響
  - 設備稼働率変動時の原価影響

- **損益分岐点分析**
  - 固定費、変動費の区分
  - 損益分岐点売上高の計算
  - 目標利益達成に必要な売上高
  - 感度分析（価格、数量、原価の変動影響）

- **採算性分析**
  - 製品別限界利益
  - 製品別貢献利益
  - 製品ミックスの最適化

#### 5.5 原価レポート
- **標準レポート**
  - 製品別原価計算書
  - 原価差異分析表
  - 部門別原価集計表
  - 材料別使用金額一覧
  - 損益計算書（製造原価明細付き）

- **カスタムレポート**
  - レポート項目の自由選択
  - 集計単位の選択（製品/工程/部門/期間）
  - グラフ種類の選択
  - レイアウトの保存

- **レポート出力**
  - Excel出力（ピボットテーブル、グラフ付き）
  - PDF出力（印刷最適化）
  - CSV出力
  - 定期レポートの自動生成・配信

### 6. 承認ワークフロー機能

#### 6.1 承認ルート設定
- **ルート種類**
  - 生産計画承認
  - 原価差異承認
  - 是正処置承認
  - マスタ変更承認
  - データ修正承認

- **ルート定義**
  - 承認者の設定（役職または個人指定）
  - 承認順序（直列/並列/条件分岐）
  - 承認期限の設定
  - エスカレーションルール
  - 代理承認者の設定

- **条件分岐**
  - 金額による分岐（閾値設定）
  - 差異率による分岐
  - 緊急度による分岐
  - 申請部門による分岐

#### 6.2 承認申請
- **申請書作成**
  - 申請内容の自動表示
  - 申請理由の入力（必須）
  - 添付資料のアップロード
  - 参考情報の自動付加（過去データ、関連データ）

- **事前チェック**
  - 必須項目の入力確認
  - データ整合性チェック
  - 承認ルートの確認
  - 承認者の在席確認（不在時は代理者へ）

- **申請実行**
  - 申請番号の自動採番
  - ステータスを「承認待ち」に変更
  - 承認者への通知（メール、システム通知）
  - 申請履歴の記録

#### 6.3 承認処理
- **承認画面**
  - 申請内容の表示
  - 関連データの表示（ドリルダウン可能）
  - 過去の承認コメント表示
  - 添付資料のプレビュー・ダウンロード

- **承認判断**
  - **承認**: 次の承認者へまたは承認完了
  - **差戻し**: 申請者へ差戻し、修正を依頼
  - **却下**: 申請を却下、計画中止
  - **保留**: 追加情報を要求、申請者へ通知
  - **条件付き承認**: 条件付きで承認、条件を明記

- **コメント入力**
  - 承認コメント（任意または必須）
  - 差戻し理由（必須）
  - 却下理由（必須）
  - テンプレート利用可能

- **承認実行**
  - 電子署名（タイムスタンプ付き）
  - 承認履歴の記録
  - 次の承認者への通知
  - 申請者への通知（進捗状況）

#### 6.4 承認状況確認
- **申請者向け**
  - 申請一覧（申請中/承認済み/差戻し/却下）
  - 承認進捗の可視化（フローチャート）
  - 現在の承認者表示
  - 承認履歴の閲覧

- **承認者向け**
  - 承認待ち一覧
  - 優先度順の表示
  - 期限超過アラート
  - 承認済み一覧

- **管理者向け**
  - 全申請の状況確認
  - 滞留案件の検出
  - 承認期限管理
  - エスカレーション実行

#### 6.5 承認期限・エスカレーション
- **期限管理**
  - 承認期限の自動設定（申請時から○営業日）
  - 期限前アラート（3日前、1日前）
  - 期限超過アラート

- **エスカレーション**
  - 期限超過時、上位者へエスカレーション
  - エスカレーションルールの設定
  - エスカレーション履歴の記録

- **代理承認**
  - 承認者不在時の代理承認
  - 代理承認者の事前設定
  - 代理承認の記録

### 7. データインポート・エクスポート機能

#### 7.1 Excelインポート機能
- **対象データ**
  - 生産計画（製品、数量、納期）
  - BOM（部品表）
  - 需要予測
  - 材料マスタ
  - 製品マスタ
  - 標準原価マスタ

- **テンプレート提供**
  - データ種別ごとのExcelテンプレート
  - サンプルデータ入り
  - 入力規則の設定（ドロップダウン、数値制限）
  - 入力ガイドシート

- **ファイルアップロード**
  - ドラッグ&ドロップ対応
  - ファイル選択ダイアログ
  - ファイルサイズ制限: 10MB
  - 対応形式: .xlsx, .xls

- **データ検証（PhpSpreadsheet使用）**
  - **形式チェック**
    - シート名の検証
    - 列ヘッダーの検証
    - データ型の検証（数値、日付、文字列）
    - 必須項目の存在チェック
  - **業務ルールチェック**
    - マスタ存在チェック（外部キー整合性）
    - 数値範囲チェック（上限・下限）
    - 日付妥当性チェック（過去日、未来日制限）
    - 重複チェック
    - 循環参照チェック（BOMの場合）
  - **詳細エラー情報**
    - エラー行番号
    - エラー列名
    - エラー内容
    - 推奨修正方法

- **検証結果表示**
  - エラー件数、警告件数のサマリー
  - エラー詳細リスト（ページング対応）
  - エラー行のハイライト表示
  - エラー内容のエクスポート（Excel）

- **データプレビュー**
  - 登録前のデータプレビュー
  - 件数表示
  - 既存データとの重複確認
  - 上書き/追加の選択

- **一括登録**
  - トランザクション処理（全件成功または全件ロールバック）
  - 登録進捗の表示（プログレスバー）
  - 登録完了通知
  - 登録結果サマリー（成功件数、スキップ件数）

#### 7.2 Excelエクスポート機能（PhpSpreadsheet使用）
- **対象データ**
  - 生産計画
  - 製造実績
  - 原価計算結果
  - 在庫一覧
  - 不良分析データ
  - 設備稼働実績

- **エクスポート設定**
  - **抽出条件**
    - 期間指定（開始日〜終了日）
    - 製品カテゴリ
    - 工場・ライン
    - ステータス
    - その他フィルタ条件
  - **出力項目選択**
    - プリセット（標準/詳細/経営報告用）
    - カスタム（項目をチェックボックスで選択）
  - **集計レベル**
    - 明細レベル
    - 日次集計
    - 週次集計
    - 月次集計

- **Excel生成機能**
  - **複数シート対応**
    - サマリーシート
    - 詳細データシート
    - グラフシート
    - 生データシート
  - **書式設定**
    - ヘッダー行の書式（背景色、太字）
    - 数値フォーマット（カンマ区切り、小数点以下桁数）
    - 日付フォーマット
    - 条件付き書式（差異のプラス/マイナスで色分け）
  - **自動計算**
    - 合計行の自動追加
    - 数式の埋め込み（SUM、AVERAGE など）
    - ピボットテーブルの自動生成
  - **グラフ挿入**
    - 棒グラフ、折れ線グラフ、円グラフ
    - グラフタイトル、軸ラベル
    - 凡例の配置
  - **列幅の自動調整**
  - **フィルタ機能の有効化**
  - **ウィンドウ枠の固定**

- **大量データ対応**
  - バックグラウンド処理（10,000件以上）
  - 進捗状況の通知
  - 完了時のメール通知
  - ファイル一時保存（7日間）

#### 7.3 PDFエクスポート機能
- **対象帳票**
  - 製造指示書
  - 検査成績書
  - 原価計算書
  - 差異分析レポート
  - 製造履歴書（トレーサビリティ）

- **PDF生成機能（DomPDF または mPDF使用）**
  - **レイアウト**
    - A4縦/横、A3
    - ヘッダー（会社ロゴ、帳票名）
    - フッター（ページ番号、出力日時）
    - 表紙の自動生成
  - **内容**
    - テーブル（罫線、背景色）
    - グラフ画像の埋め込み
    - QRコード/バーコードの生成
    - 電子署名（オプション）
  - **日本語対応**
    - 日本語フォントの埋め込み
    - 文字化け防止

#### 7.4 CSVエクスポート
- **文字コード選択**
  - UTF-8
  - Shift-JIS（Excelで開く場合）

- **区切り文字選択**
  - カンマ
  - タブ
  - セミコロン

- **ヘッダー行**
  - 有り/無し選択
  - 日本語または英語列名

### 8. マスタ管理機能

#### 8.1 製品マスタ
- **登録項目**
  - 製品コード（一意）
  - 製品名
  - 製品カテゴリ
  - 規格・型番
  - 単位（個、kg、mなど）
  - 標準原価
  - 標準製造時間
  - リードタイム
  - 安全在庫数
  - 発注点
  - 有効/無効フラグ

- **機能**
  - 検索（製品コード、名称、カテゴリ）
  - 一覧表示（ページング、ソート）
  - 詳細表示
  - 登録・編集・削除（論理削除）
  - 使用状況確認（どの計画で使用中か）
  - インポート/エクスポート

#### 8.2 材料マスタ
- **登録項目**
  - 材料コード（一意）
  - 材料名
  - 材料カテゴリ
  - 規格
  - 単位
  - 標準単価
  - 仕入先
  - リードタイム
  - 最小発注量
  - 安全在庫数
  - ロット管理（有/無）
  - 有効期限管理（有/無）

- **機能**
  - 検索・一覧・詳細
  - 登録・編集・削除
  - 単価履歴管理（過去の単価推移）
  - 在庫照会
  - インポート/エクスポート

#### 8.3 BOM（部品表）マスタ
- **登録項目**
  - 親品目コード
  - 子品目コード
  - 使用数量
  - 歩留まり率
  - 有効開始日
  - 有効終了日

- **機能**
  - ツリー表示（親子関係の可視化）
  - 階層展開（最下層まで）
  - 逆展開（この部品を使う製品は？）
  - コピー機能（類似BOMの複製）
  - バージョン管理
  - 有効期間管理
  - Excelインポート/エクスポート

#### 8.4 設備マスタ
- **登録項目**
  - 設備コード
  - 設備名
  - 設備カテゴリ
  - 工程
  - 生産能力（個/時間）
  - 段取り時間
  - 時間チャージ（円/時間）
  - メンテナンス周期
  - 使用場所

- **機能**
  - 検索・一覧・詳細
  - 登録・編集・削除
  - 稼働カレンダー設定
  - メンテナンス履歴
  - 故障履歴

#### 8.5 作業者マスタ
- **登録項目**
  - 社員番号
  - 氏名
  - 所属部門
  - 職種
  - 等級
  - 時間単価
  - スキル（保有資格、習熟度）
  - 勤務パターン

- **機能**
  - 検索・一覧・詳細
  - 登録・編集
  - スキルマトリクス表示
  - 勤務実績照会

### 9. 分析・レポート機能

#### 9.1 ダッシュボード
- **カスタマイズ可能なダッシュボード**
  - ウィジェットの追加・削除
  - ウィジェットの配置変更（ドラッグ&ドロップ）
  - ウィジェットサイズ変更
  - ダッシュボードレイアウトの保存

- **標準ウィジェット**
  - KPIメーター（目標達成率）
  - トレンドグラフ
  - ランキング表
  - パレート図
  - アラート一覧
  - タスク一覧

#### 9.2 生産分析
- **設備稼働分析**
  - 設備別稼働率
  - 時間帯別稼働率
  - 停止時間分析（停止理由別）
  - OEE（総合設備効率）計算

- **生産性分析**
  - 作業者別生産性
  - 製品別生産性
  - ラーニングカーブ分析

- **納期遵守分析**
  - 納期遵守率推移
  - 遅延理由分析
  - 遅延日数分布

#### 9.3 品質分析
- **不良分析**
  - 不良率推移
  - 不良内容別パレート図
  - 工程別不良発生率
  - 製品別不良率

- **統計的品質管理**
  - ヒストグラム
  - 管理図（Xbar-R、p図、c図）
  - 工程能力指数（Cp、Cpk）
  - 散布図・相関分析

#### 9.4 原価分析
- **原価推移分析**
  - 製品別原価推移
  - 原価要素別推移（材料/労務/経費）
  - 前年同期比較

- **原価構成分析**
  - 製品別原価構成比
  - 工程別原価配分
  - ABC分析（重点管理品目）

- **差異分析**
  - 差異トレンド
  - 差異要因分析
  - 改善効果測定

---

## 非機能要件

### 1. 環境要件

#### 1.1 サーバー環境
- **Webサーバー**: Nginx 1.24以上
- **アプリケーションサーバー**: PHP 8.2以上（Laravel 11.x）
- **データベース**: PostgreSQL 15以上（推奨） または MySQL 8.0以上
- **キャッシュサーバー**: Redis 7.0以上
- **キューサーバー**: Redis（Laravel Queue）または RabbitMQ
- **検索エンジン**: Elasticsearch 8.0以上（オプション、大量データ検索用）
- **OS**: Ubuntu 22.04 LTS または Amazon Linux 2023

- **推奨サーバースペック（中規模工場想定）**
  - CPU: 8コア以上
  - メモリ: 32GB以上
  - ディスク: SSD 500GB以上（データ量に応じて拡張）
  - ネットワーク: 1Gbps

#### 1.2 クライアント環境
- **対応ブラウザ**
  - Google Chrome（最新版および1つ前のバージョン）
  - Mozilla Firefox（最新版および1つ前のバージョン）
  - Microsoft Edge（最新版および1つ前のバージョン）
  - Safari（最新版、Mac/iPadのみ）

- **デバイス対応**
  - **デスクトップPC**（管理業務）
    - 画面解像度: 1920×1080以上推奨
    - OS: Windows 10/11、macOS 12以降
  - **タブレット**（現場端末）
    - iPad（iOS 15以上）
    - Androidタブレット（Android 10以上）
    - 画面サイズ: 10インチ以上推奨
  - **スマートフォン**（簡易確認用）
    - iOS 15以上
    - Android 10以上

- **周辺機器**
  - バーコードスキャナー（USB/Bluetooth）
  - QRコードリーダー（カメラまたは専用機）
  - ラベルプリンター
  - レシートプリンター（現場帳票印刷用）

#### 1.3 ネットワーク
- **通信プロトコル**: HTTPS（TLS 1.3推奨、最低TLS 1.2）
- **帯域**:
  - インターネット接続: 100Mbps以上
  - 社内LAN: 1Gbps以上
- **ネットワーク構成**
  - DMZ（外部アクセス用）
  - 社内ネットワーク（内部アクセス用）
  - ファイアウォール必須

#### 1.4 外部連携
- **ERPシステム**: REST API または SOAP連携
- **販売管理システム**: 受注データ連携（CSV/API）
- **会計システム**: 原価データ連携（CSV/API）
- **PLCシステム**: 設備稼働データ連携（OPC UA、MQTT）

### 2. ユーザービリティ

#### 2.1 操作性
- **学習時間**
  - 一般ユーザー（実績入力のみ）: 30分以内
  - 生産管理者（計画立案）: 2時間以内
  - 原価計算担当者: 4時間以内

- **タスク完了時間**
  - 実績入力: 1分以内/件
  - 生産計画立案: 30分以内（計画案作成含む）
  - 原価計算実行: 5分以内（1ヶ月分）

- **レスポンス時間**
  - 画面遷移: 1秒以内
  - 検索結果表示: 2秒以内
  - 計画案作成: 3分以内（通知あり）

#### 2.2 画面設計
- **一貫性**
  - 統一されたナビゲーション構造
  - 統一されたUIコンポーネント
  - 統一されたアイコンセット
  - 統一されたカラースキーム

- **視認性**
  - フォントサイズ: 最小14px
  - コントラスト比: 4.5:1以上
  - 重要な情報の強調表示
  - 色覚多様性への配慮（色のみに依存しない）

- **操作性**
  - クリック/タップ領域: 最小44×44px
  - キーボードショートカット対応
  - タブオーダーの最適化
  - ドラッグ&ドロップ操作

#### 2.3 エラーハンドリング
- **エラーメッセージ**
  - 明確なエラー内容
  - 対処方法の提示
  - エラーコードの表示
  - サポート窓口への誘導

- **入力支援**
  - リアルタイムバリデーション
  - サジェスト機能
  - 入力例の表示
  - 自動補完

#### 2.4 ヘルプ機能
- **オンラインヘルプ**
  - 画面別ヘルプ
  - 用語集
  - FAQ
  - 操作動画（チュートリアル）

- **コンテキストヘルプ**
  - ツールチップ
  - ヘルプアイコン
  - ガイドツアー（初回利用時）

### 3. 可用性

#### 3.1 稼働率
- **目標稼働率**: 99.5%以上（年間ダウンタイム43.8時間以内）
- **稼働時間**: 24時間365日
- **計画メンテナンス**: 月1回、深夜時間帯（2:00-4:00、2時間以内）
- **メンテナンス通知**: 1週間前に予告

#### 3.2 バックアップ
- **データバックアップ**
  - **フルバックアップ**: 毎日1回（深夜3:00実行）
  - **差分バックアップ**: 6時間ごと
  - **トランザクションログバックアップ**: 15分ごと

- **バックアップ保存先**
  - プライマリ: オンサイトNAS
  - セカンダリ: クラウドストレージ（AWS S3、Azure Blob など）
  - 地理的に離れた2拠点

- **保存期間**
  - フルバックアップ: 30日間
  - 差分バックアップ: 7日間
  - トランザクションログ: 7日間
  - 月次バックアップ: 12ヶ月間

- **リストア**
  - RTO（目標復旧時間）: 4時間以内
  - RPO（目標復旧時点）: 最大15分前
  - リストア訓練: 年2回実施

#### 3.3 冗長化
- **アプリケーションサーバー**
  - ロードバランサー配下に複数台配置
  - アクティブ・アクティブ構成
  - 自動フェイルオーバー

- **データベースサーバー**
  - マスター・スレーブレプリケーション
  - 自動フェイルオーバー（30秒以内）
  - スレーブは読み取り専用で負荷分散にも利用

- **ストレージ**
  - RAID構成（RAID10推奨）
  - 冗長化電源
  - ホットスペア

- **ネットワーク**
  - 冗長化回線
  - 冗長化ルーター・スイッチ

#### 3.4 障害検知・監視
- **ヘルスチェック**
  - 死活監視（30秒間隔）
  - アプリケーション監視（1分間隔）
  - データベース監視（1分間隔）
  - ディスク使用率監視

- **アラート通知**
  - メール通知
  - Slack/Teams通知
  - SMS通知（重大障害時）
  - 電話通知（夜間の重大障害時）

- **ログ監視**
  - エラーログの監視
  - 異常パターンの検知
  - セキュリティイベントの検知

### 4. 性能要件

#### 4.1 レスポンスタイム
- **画面表示**
  - 初回表示: 2秒以内
  - 2回目以降（キャッシュ利用）: 1秒以内

- **データ検索**
  - 簡易検索: 1秒以内
  - 複雑検索: 3秒以内
  - 全文検索: 2秒以内

- **データ登録・更新**
  - 単一レコード: 1秒以内
  - 一括登録（100件）: 5秒以内
  - 一括登録（1,000件）: 30秒以内

- **レポート生成**
  - 簡易レポート: 3秒以内
  - 月次レポート: 10秒以内
  - 年次レポート: 30秒以内

- **複雑な計算処理**
  - 生産計画最適化: 3分以内
  - 原価計算（1ヶ月分）: 5分以内
  - BOM展開計算: 10秒以内

#### 4.2 スループット
- **同時接続ユーザー数**
  - 通常時: 200ユーザー
  - ピーク時（月初・月末）: 500ユーザー
  - 最大: 1,000ユーザー

- **トランザクション処理**
  - 100 TPS（Transactions Per Second）

- **API応答**
  - 平均: 200ms以下
  - 95パーセンタイル: 500ms以下

#### 4.3 データ量
- **想定データ量（5年間）**
  - 製品マスタ: 10,000件
  - 材料マスタ: 50,000件
  - BOM: 100,000件
  - 生産計画: 10,000件/年 = 50,000件
  - 製造指示: 100,000件/年 = 500,000件
  - 製造実績: 1,000,000件/年 = 5,000,000件
  - 原価計算結果: 100,000件/年 = 500,000件

- **ファイルストレージ**
  - 初期: 100GB
  - 年間増加: 200GB
  - 5年後: 1.1TB

#### 4.4 スケーラビリティ
- **水平スケーリング**
  - アプリケーションサーバーの台数追加
  - ロードバランサーによる負荷分散
  - セッション共有（Redis使用）

- **垂直スケーリング**
  - CPU・メモリの増強
  - ストレージの拡張

- **自動スケーリング**
  - CPU使用率70%超で自動スケールアウト
  - 負荷低下時の自動スケールイン

### 5. セキュリティ要件

#### 5.1 認証・認可
- **パスワードポリシー**（前述の認証機能を参照）

- **多要素認証**
  - 管理者: 必須
  - 経営層: 必須
  - その他: 任意（推奨）
  - 方式: TOTP（Google Authenticator等）、SMS、メール

- **アクセス制御**
  - ロールベースアクセス制御（RBAC）
  - 最小権限の原則
  - 職務分掌の徹底

#### 5.2 データ保護
- **暗号化**
  - **通信の暗号化**: TLS 1.2以上（TLS 1.3推奨）
  - **データベース暗号化**: 透過的データ暗号化（TDE）
  - **バックアップの暗号化**: AES-256
  - **機密フィールドの暗号化**: 原価データ、単価情報（AES-256）

- **アクセスログ**
  - すべてのデータアクセスを記録
  - 変更履歴の記録（誰が、いつ、何を変更したか）
  - ログの改ざん防止

- **データマスキング**
  - 開発環境では本番データをマスキング
  - 非権限者への原価情報のマスキング

#### 5.3 脆弱性対策
- **OWASP Top 10対策**
  - SQLインジェクション対策
  - XSS対策
  - CSRF対策
  - 認証・セッション管理の脆弱性対策
  - アクセス制御の不備対策
  - セキュリティ設定ミス対策
  - 機微データの露出対策
  - XXE（XML外部エンティティ）対策
  - 安全でないデシリアライゼーション対策
  - 不十分なロギング・監視対策

- **入力値検証**
  - ホワイトリスト方式
  - サニタイジング
  - 型チェック、範囲チェック

- **ファイルアップロード対策**
  - ファイルタイプ検証
  - ファイルサイズ制限
  - ウイルススキャン
  - 実行権限の削除

#### 5.4 ネットワークセキュリティ
- **ファイアウォール**
  - 不要なポートの閉鎖
  - IPアドレス制限
  - WAF（Web Application Firewall）の導入

- **IDS/IPS**
  - 侵入検知・防止システムの導入
  - 異常トラフィックの検知

- **DDoS対策**
  - レート制限
  - CDN利用

#### 5.5 監査・コンプライアンス
- **監査ログ**
  - すべての重要操作を記録
  - 改ざん防止
  - 長期保存（最低3年）

- **アクセスログ**
  - ログイン/ログアウト
  - データアクセス
  - 設定変更
  - エクスポート操作

- **定期的なセキュリティ監査**
  - 年2回の脆弱性診断
  - 年1回のペネトレーションテスト
  - セキュリティパッチの適用（月次）

### 6. 技術要件

#### 6.1 開発技術スタック
- **フロントエンド**
  - HTML5, CSS3
  - Tailwind CSS（ユーティリティファーストCSS）
  - JavaScript（ES6+）
  - Laravel Blade テンプレートエンジン
  - Alpine.js（軽量リアクティブフレームワーク）
  - Chart.js / ApexCharts（グラフ表示）
  - FullCalendar（スケジュール表示）

- **バックエンド**
  - PHP 8.2+
  - Laravel 11.x
  - RESTful API設計
  - Laravel Sanctum（API認証）
  - Laravel Queue（非同期処理）
  - Laravel Schedule（定期実行）

- **ライブラリ・パッケージ**
  - **PhpSpreadsheet**: Excel読み書き
  - **DomPDF / mPDF**: PDF生成
  - **Intervention Image**: 画像処理
  - **SimpleSoftwareIO/simple-qrcode**: QRコード生成
  - **Laravel Backup**: バックアップ自動化
  - **Spatie Laravel Permission**: 権限管理

- **データベース**
  - PostgreSQL 15+（推奨）
  - マイグレーション管理（Laravel Migration）
  - シーディング（テストデータ）
  - インデックス最適化

- **キャッシュ・キュー**
  - Redis（セッション、キャッシュ、キュー）
  - Laravel Cache
  - Laravel Queue

- **検索**
  - PostgreSQL全文検索
  - Elasticsearch（オプション、大量データ用）

#### 6.2 計画・在庫ロジック
- **生産計画ロジック**
  - **ルールベースのスケジューリング**
    - 優先度ルール（納期優先、設備稼働率優先など）
    - 制約条件チェック（設備能力、段取り時間、材料在庫）
    - 実行可能性検証
  - **計画案の評価**
    - 設備稼働率の計算
    - 納期遵守率の計算
    - 段取り回数・時間の集計
    - 在庫金額の計算

- **在庫管理ロジック**
  - 経済的発注量（EOQ）
  - 安全在庫計算
  - ABC分析
  - 先入先出（FIFO）管理

#### 6.3 開発環境・ツール
- **バージョン管理**: Git（GitHub、GitLab、Bitbucket）
- **ブランチ戦略**: Git Flow
- **CI/CD**
  - GitHub Actions / GitLab CI / Jenkins
  - 自動テスト実行
  - 自動デプロイ（ステージング環境）
  - コード品質チェック

- **コード品質**
  - PHP CS Fixer（PSR-12準拠）
  - PHPStan（静的解析、レベル8）
  - Larastan（Laravel用PHPStan）
  - ESLint（JavaScript）

- **テスト**
  - PHPUnit（単体テスト）
  - Pest（モダンなテストフレームワーク）
  - Laravel Dusk（ブラウザテスト）
  - テストカバレッジ: 80%以上

- **ドキュメント**
  - OpenAPI（Swagger）仕様書
  - ER図（draw.io、dbdiagram.io）
  - README、開発ガイド
  - PHPDoc形式のコメント

#### 6.4 インフラ・デプロイ
- **コンテナ化**
  - Docker
  - Docker Compose（開発環境）
  - Kubernetes（本番環境、オプション）

- **クラウド（推奨: AWS）**
  - **コンピューティング**: EC2、ECS（Docker）、Lambda（バッチ処理）
  - **データベース**: RDS（PostgreSQL/MySQL）
  - **キャッシュ**: ElastiCache（Redis）
  - **ストレージ**: S3（ファイル保存）、EBS（ディスク）
  - **CDN**: CloudFront
  - **ロードバランサー**: ALB（Application Load Balancer）
  - **DNS**: Route 53
  - **監視**: CloudWatch、X-Ray
  - **セキュリティ**: WAF、Shield、Secrets Manager

- **オンプレミス（代替）**
  - VMware vSphere / Hyper-V
  - ロードバランサー（HAProxy、Nginx）
  - NAS（Synology、QNAP）

- **デプロイ戦略**
  - ゼロダウンタイムデプロイ
  - ブルーグリーンデプロイメント
  - ロールバック機能
  - カナリアリリース（段階的リリース）

#### 6.5 監視・運用
- **アプリケーション監視**
  - Laravel Telescope（開発環境）
  - New Relic / Datadog（本番環境）
  - カスタムメトリクス（ビジネスKPI）

- **サーバー監視**
  - Prometheus + Grafana
  - CloudWatch（AWS）
  - Zabbix（オンプレミス）

- **エラートラッキング**
  - Sentry
  - Bugsnag
  - Laravel Log Viewer

- **稼働監視**
  - UptimeRobot
  - Pingdom
  - StatusCake

- **ログ管理**
  - ELKスタック（Elasticsearch、Logstash、Kibana）
  - CloudWatch Logs（AWS）
  - ログローテーション
  - ログの長期保存（S3）

#### 6.6 コーディング規約
- **PHP**
  - PSR-12準拠
  - Laravel Best Practices準拠
  - 型宣言の徹底（strict_types=1）

- **JavaScript**
  - Airbnb JavaScript Style Guide準拠
  - ES6+の活用

- **命名規則**
  - クラス名: PascalCase
  - メソッド名: camelCase
  - 変数名: camelCase
  - 定数: UPPER_SNAKE_CASE
  - データベーステーブル: snake_case（複数形）
  - データベースカラム: snake_case

- **コメント**
  - PHPDoc形式
  - 複雑なロジックには必ずコメント
  - TODO、FIXME、HACKの明記

#### 6.7 データベース設計
- **設計原則**
  - 第3正規形以上
  - 適切なインデックス設計
  - 外部キー制約の活用
  - トランザクション整合性の保証

- **テーブル設計**
  - 論理削除（deleted_atカラム）
  - 作成・更新タイムスタンプ（created_at、updated_at）
  - 作成者・更新者（created_by、updated_by）
  - バージョン管理（versionカラム、楽観的ロック）

- **パフォーマンス最適化**
  - 適切なインデックス
  - パーティショニング（大量データテーブル）
  - マテリアライズドビュー（集計用）

#### 6.8 API設計
- **RESTful原則**
  - リソース指向URL
  - HTTPメソッドの適切な使用
  - ステータスコードの適切な使用

- **バージョニング**
  - URLベース: /api/v1/...
  - 後方互換性の維持

- **認証**
  - Laravel Sanctum（トークンベース）
  - OAuth 2.0（サードパーティ連携用、オプション）

- **レート制限**
  - 一般API: 60リクエスト/分
  - 認証済みAPI: 300リクエスト/分
  - 管理者API: 1000リクエスト/分

- **ドキュメント**
  - OpenAPI（Swagger）仕様書
  - Postmanコレクション

---

## 補足事項

### 想定される技術的課題と対応

#### 1. 計画案作成の性能
- **課題**: 大規模な生産計画の作成に時間がかかる
- **対応**:
  - 非同期処理（Laravel Queue）
  - 進捗表示
  - タイムアウト設定
  - 計算途中結果の保存
  - 段階的な計算（粗い計画→詳細計画）

#### 2. 大量データの処理
- **課題**: 数百万件の製造実績データの検索・集計が遅い
- **対応**:
  - データベースインデックスの最適化
  - パーティショニング（年月別）
  - Elasticsearch導入
  - 集計テーブル（マテリアライズドビュー）
  - 定期的なアーカイブ

#### 3. リアルタイム性の確保
- **課題**: 在庫数量、設備稼働状況のリアルタイム更新
- **対応**:
  - Redis Pub/Sub
  - Laravel Broadcasting（Pusher、Ably）
  - WebSocket（Laravel Echo Server）
  - ポーリング（fallback）

#### 4. Excel処理の性能
- **課題**: 大量データのExcelインポート/エクスポートに時間がかかる
- **対応**:
  - バックグラウンド処理（Laravel Queue）
  - チャンク処理（分割処理）
  - メモリ使用量の最適化
  - 進捗通知

#### 5. 複雑な権限制御
- **課題**: 工場別、製品カテゴリ別の細かい権限制御
- **対応**:
  - Spatie Laravel Permission
  - ポリシークラスの活用
  - ゲート定義
  - ミドルウェアでの制御

### 開発フェーズ

#### フェーズ1: MVP（Minimum Viable Product）- 3ヶ月
- 基本マスタ管理
- 生産計画立案（手動調整中心）
- 製造指示・実績管理
- 簡易原価計算
- 基本レポート

#### フェーズ2: 機能拡張 - 3ヶ月
- 生産計画機能の拡張（複数パターン比較、シミュレーション）
- 承認ワークフロー
- Excel インポート/エクスポート
- 詳細原価計算・差異分析
- 品質管理機能

#### フェーズ3: 高度化 - 3ヶ月
- 高度な分析機能
- ダッシュボードカスタマイズ
- 外部システム連携
- IoT連携（設備稼働データ）
- モバイルアプリ

### 成功指標（KPI）

- **生産効率**: 設備稼働率 20%向上
- **原価計算**: 計算リードタイム 80%削減（数週間 → 数日）
- **承認期間**: 承認リードタイム 50%削減
- **品質**: 不良率 30%削減（トレーサビリティ向上により）
- **システム稼働率**: 99.5%以上
- **ユーザー満足度**: 4.0/5.0以上

---

**作成日**: 2025年12月14日
**バージョン**: 1.0
**承認者**: （承認者名）
**次回レビュー予定**: （日付）
